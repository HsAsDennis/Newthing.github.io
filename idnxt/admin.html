<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶²ç«™å¾Œå°ç®¡ç†ç³»çµ± | æœªä¾†ç§‘æŠ€</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* ... (æ‰€æœ‰ CSS æ¨£å¼ - ç„¡è®Šå‹•) ... */
        :root {
            --color-dark-bg: #0A0A0A;
            --color-primary: #00FFFF;
            --color-secondary: #0077B6;
            --color-text-light: #F0F0F0;
            --color-text-dim: #AAAAAA;
            --color-danger: #FF6B6B;
            --color-success: #4CAF50;
            --color-warning: #FFC107;
            --sidebar-width: 250px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--color-dark-bg); color: var(--color-text-light); line-height: 1.6; }
        a { color: var(--color-primary); text-decoration: none; }
        h2 { color: var(--color-primary); margin-bottom: 20px; border-bottom: 2px solid var(--color-secondary); padding-bottom: 10px; }
        h3 { color: var(--color-text-light); margin-top: 25px; margin-bottom: 15px; border-bottom: 1px dashed #333; padding-bottom: 5px;}

        /* ä¸»è¦ä½ˆå±€ */
        .admin-layout { display: flex; min-height: 100vh; }

        /* å´é‚Šæ¬„ */
        .sidebar {
            width: var(--sidebar-width); background-color: #1A1A1A; padding: 20px;
            flex-shrink: 0; border-right: 1px solid var(--color-secondary);
            display: flex; flex-direction: column;
        }
        .sidebar h1 { color: var(--color-text-light); font-size: 1.5em; text-align: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .sidebar nav { flex-grow: 1; }
        .sidebar nav ul { list-style: none; }
        .sidebar nav ul li { margin-bottom: 5px; }
        .sidebar nav ul li a {
            display: block; padding: 10px 15px; color: var(--color-text-dim); font-weight: bold;
            border-radius: 5px; transition: background-color 0.2s, color 0.2s;
        }
        .sidebar nav ul li a i { margin-right: 10px; width: 20px; text-align: center; }
        .sidebar nav ul li a:hover { background-color: #2A2A2A; color: var(--color-text-light); }
        .sidebar nav ul li a.active { background-color: var(--color-secondary); color: white; }
        /* ç™»å‡ºæŒ‰éˆ• */
        .logout-section a {
            background-color: var(--color-danger); color: white; text-align: center;
        }
        .logout-section a:hover { background-color: #ff8b8b; }

        /* ä¸»è¦å…§å®¹å€ */
        .main-content { flex-grow: 1; padding: 30px; overflow-x: hidden; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* é ‚éƒ¨æ“ä½œæ¬„ */
        .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;}
        .search-bar { display: flex; gap: 10px; }

        /* æŒ‰éˆ• */
        .btn {
            padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;
            font-weight: bold; transition: all 0.2s;
        }
        .btn-primary { background-color: var(--color-success); color: white; }
        .btn-secondary { background-color: var(--color-secondary); color: white; }
        .btn-danger { background-color: var(--color-danger); color: white; }
        .btn-warning { background-color: var(--color-warning); color: black; }
        .btn:hover { opacity: 0.8; }
        .btn i { margin-right: 5px; }
        
        .btn-edit { background-color: var(--color-warning); color: black; padding: 5px 10px; font-size: 0.9em;}
        .btn-delete { background-color: var(--color-danger); color: white; padding: 5px 10px; font-size: 0.9em;}

        /* è¡¨æ ¼ */
        .table-responsive { overflow-x: auto; }


        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #222; }
        .data-table th { background-color: #1A1A1A; color: var(--color-primary); }
        .data-table tbody tr:hover { background-color: #151515; }
        .data-table td { vertical-align: middle; }
        .thumb-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid #333; }
        .featured-indicator, .status-indicator { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; }
        .featured-indicator.yes, .status-indicator.yes { background-color: var(--color-success); }
        .featured-indicator.no, .status-indicator.no { background-color: var(--color-text-dim); }
        
        .message-cell {
            max-width: 250px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }
        .message-cell:hover { white-space: normal; overflow: visible; }
        
        /* ğŸ’¡ æ–°å¢ï¼šç”¨æ–¼ FAQ ç­”æ¡ˆçš„æ¬„ä½ */
        .answer-cell {
            max-width: 400px;
            font-size: 0.9em;
            color: var(--color-text-dim);
        }
        /* ğŸ’¡ æ–°å¢ï¼šç”¨æ–¼ Icon é¡¯ç¤ºçš„æ¬„ä½ */
        .icon-cell i {
            font-size: 1.5em;
            color: var(--color-text-light);
        }


        /* æ•¸æ“šåˆ†æå¡ç‰‡ */
        #statsGrid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background-color: #1A1A1A; padding: 20px; border-radius: 8px;
            border-left: 5px solid var(--color-primary); position: relative;
        }
        .stat-card h3 { font-size: 1.1em; color: var(--color-text-dim); margin: 0 0 10px 0; border: none; }
        .stat-card p { font-size: 2em; font-weight: bold; color: var(--color-text-light); }
        .stat-card .icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 2.5em; color: var(--color-primary); opacity: 0.2; }

        /* è¡¨å–®èˆ‡è¼¸å…¥æ¡† */
        input[type="text"], input[type="password"], input[type="email"], input[type="number"], input[type="url"], select, textarea {
            width: 100%; padding: 10px; background: #0A0A0A; border: 1px solid #333;
            color: white; border-radius: 3px; margin-bottom: 10px;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--color-primary); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        /* ğŸ’¡ æ–°å¢ï¼šç”¨æ–¼ Checkbox çš„æ¨£å¼ */
        .form-group-inline {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        .form-group-inline input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        .form-group-inline label {
            margin: 0;
            font-weight: normal;
        }

        /* å½ˆçª— (Modal) */
        .modal {
            display: none; position: fixed; z-index: 3000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(3px);
        }
        .modal-content {
            background-color: #1A1A1A; margin: 5% auto; padding: 30px;
            border: 1px solid var(--color-secondary); border-radius: 8px;
            width: 90%; max-width: 600px; position: relative;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; border: none; }
        .close-btn { color: var(--color-text-dim); font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-btn:hover { color: white; }
        #productImagePreview { max-width: 100%; height: auto; margin-top: 10px; border-radius: 5px; }

        /* ç³»çµ±è¨­å®šä½ˆå±€ */
        .settings-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .settings-card {
            background-color: #1A1A1A;
            padding: 20px;
            border-radius: 8px;
        }
        .settings-card h3 { margin-top: 0; }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 1200px) {
            #statsGrid { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 960px) {
            .settings-layout { grid-template-columns: 1fr; }
            .data-table th:nth-child(5), .data-table td:nth-child(5),
            .data-table th:nth-child(4), .data-table td:nth-child(4) {
                 display: none;
            }
        }
        @media (max-width: 768px) {
            .admin-layout { flex-direction: column; }
            .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--color-secondary); }
            #statsGrid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .content-header { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>

    <div class="admin-layout">
        
        <aside class="sidebar">
            <h1><i class="fas fa-tachometer-alt"></i> å¾Œå°ç®¡ç†ä¸­å¿ƒ</h1>
            <nav>
                <ul>
                    <li class="nav-item"><a href="#" class="nav-link" data-tab="analytics"><i class="fas fa-chart-line"></i> æ•¸æ“šåˆ†æ</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-tab="orders"><i class="fas fa-receipt"></i> è¨‚å–®ç®¡ç†</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-tab="products"><i class="fas fa-box-open"></i> ç”¢å“ç®¡ç†</a></li>
                    
                    <li class="nav-item"><a href="#" class="nav-link" data-tab="downloads"><i class="fas fa-download"></i> ä¸‹è¼‰ç®¡ç†</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-tab="faqs"><i class="fas fa-question-circle"></i> ç–‘å•ç®¡ç† (FAQ)</a></li>
                    
                    <li class="nav-item"><a href="#" class="nav-link" data-tab="users"><i class="fas fa-users"></i> ä½¿ç”¨è€…ç®¡ç†</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" data-tab="settings"><i class="fas fa-cog"></i> ç³»çµ±è¨­å®š</a></li>
                </ul>
            </nav>
            <div class="logout-section">
                <ul>
                    <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> ç™»å‡ºä¸¦è¿”å›é¦–é </a></li>
                </ul>
            </div>
        </aside>

        <main class="main-content">
            
            <div id="analytics" class="tab-content active">
                <div class="content-header">
                    <h2>ç¶²ç«™æ•¸æ“šåˆ†æ</h2>
                    <button class="btn btn-secondary" id="exportSalesButton"><i class="fas fa-file-csv"></i> åŒ¯å‡ºéŠ·å”®æ•¸æ“š</button>
                </div>
                <div id="statsGrid"></div>
                <div class="form-grid">
                    <div>
                        <h3>å”®å‡ºå•†å“æ’è¡Œæ¦œ</h3>
                        <div class="table-responsive">
                            <table id="salesTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th>å•†å“åç¨±</th>
                                        <th>ID</th>
                                        <th>å”®å‡ºæ•¸é‡</th>
                                        <th>éŠ·å”®é‡‘é¡</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <h3>äº¤æ˜“æ¬¡æ•¸ (æœˆ/å¹´)</h3>
                        <div class="table-responsive">
                            <table id="transactionsTable" class="data-table">
                                <thead>
                                    <tr>
                                        <th>æœŸé–“</th>
                                        <th>äº¤æ˜“æ¬¡æ•¸</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="orders" class="tab-content">
                <div class="content-header">
                    <h2>è¨‚å–®ç®¡ç† (æ¨¡æ“¬è³‡æ–™)</h2>
                </div>
                <div class="table-responsive">
                    <table id="orderTable" class="data-table">
                        <thead>
                            <tr>
                                <th>è¨‚å–® ID</th>
                                <th>æ—¥æœŸ</th>
                                <th>æœƒå“¡</th>
                                <th>è³¼è²·å•†å“è©³æƒ…</th>
                                <th>ç¸½é‡‘é¡</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="products" class="tab-content">
                <div class="content-header">
                    <h2>ç”¢å“ç®¡ç†</h2>
                    <button class="btn btn-primary" id="addNewProductBtn"><i class="fas fa-plus"></i> æ–°å¢å•†å“</button>
                </div>
                <div class="table-responsive">
                    <table id="productTable" class="data-table">
                        <thead>
                            <tr>
                                <th>åœ–ç‰‡</th>
                                <th>ID</th>
                                <th>åç¨±</th>
                                <th>åƒ¹æ ¼</th>
                                <th>åº«å­˜</th>
                                <th>é¡¯ç¤ºæ–¼é¦–é  (ç†±éŠ·)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="downloads" class="tab-content">
                <div class="content-header">
                    <h2>ä¸‹è¼‰ä¸­å¿ƒç®¡ç†</h2>
                    <button class="btn btn-primary" id="addNewDownloadBtn"><i class="fas fa-plus"></i> æ–°å¢ä¸‹è¼‰é …ç›®</button>
                </div>
                <div class="table-responsive">
                    <table id="downloadTable" class="data-table">
                        <thead>
                            <tr>
                                <th>åœ–ç¤º</th>
                                <th>é¡åˆ¥ (for faq_download)</th>
                                <th>æ¨™é¡Œ</th>
                                <th>èªªæ˜</th>
                                <th>é¡¯ç¤º (Visible)</th>
                                <th>å¯ä¸‹è¼‰ (Downloadable)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="faqs" class="tab-content">
                <div class="content-header">
                    <h2>å¸¸è¦‹ç–‘å• (FAQ) ç®¡ç†</h2>
                    <button class="btn btn-primary" id="addNewFaqBtn"><i class="fas fa-plus"></i> æ–°å¢ FAQ</button>
                </div>
                <div class="table-responsive">
                    <table id="faqTable" class="data-table">
                        <thead>
                            <tr>
                                <th>å•é¡Œ (Question)</th>
                                <th>ç­”æ¡ˆ (Answer) - (æ”¯æ´ HTML)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>


            
            <div id="users" class="tab-content">
                <h2>ä½¿ç”¨è€…ç®¡ç†</h2>
                <h3>æœƒå“¡åˆ—è¡¨ (æ¨¡æ“¬è³‡æ–™ & ç¶²ç«™è¨»å†Š)</h3>
                <div class="content-header">
                    <span>æ­¤åˆ—è¡¨åŒ…å«æ¨¡æ“¬è³‡æ–™ï¼Œä»¥åŠå¾å‰å°è¨»å†Šçš„çœŸå¯¦æœƒå“¡ã€‚</span>
                    <div class="search-bar">
                        <input type="text" id="userSearchInput" placeholder="æœå°‹å§“åæˆ–å¸³è™Ÿ..." style="margin-bottom: 0;">
                        <button class="btn btn-secondary" id="userSearchButton"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="userTable" class="data-table">
                        <thead>
                            <tr>
                                <th>ID / é¡å‹</th>
                                <th>å§“å</th>
                                <th>å¸³è™Ÿ (Email)</th>
                                <th>å¯†ç¢¼ (æ¨¡æ“¬åŠ å¯†)</th>
                                <th>ä¿®æ”¹å¯†ç¢¼</th>
                                <th>Email</th>
                                <th>ç¸½æ¶ˆè²» (æ¨¡æ“¬)</th>
                                <th>è³¼è²·ç´€éŒ„ (æ¨¡æ“¬)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <h3>å‰å°è«®è©¢ç™»è¨˜ (LocalStorage: USER_REGISTRATIONS)</h3>
                <div class="content-header">
                    <span>æ­¤è™•é¡¯ç¤ºå‰å° "é—œæ–¼æˆ‘å€‘" é é¢è«®è©¢è¡¨å–®çš„æäº¤è³‡æ–™ã€‚</span>
                    <button class="btn btn-danger" id="clearRegistrationsButton"><i class="fas fa-trash-alt"></i> æ¸…ç©ºè«®è©¢</button>
                </div>
                <div class="table-responsive">
                    <table id="registrationTable" class="data-table">
                        <thead>
                            <tr>
                                <th>æäº¤æ—¥æœŸ</th>
                                <th>å§“å</th>
                                <th>å–®ä½</th>
                                <th>Email</th>
                                <th>é›»è©±</th>
                                <th>è«®è©¢å•é¡Œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="settings" class="tab-content">
                <h2>ç³»çµ±è¨­å®š</h2>
                <div class="settings-layout">
                    <div class="settings-card">
                        <h3>ä¸»è¦ç®¡ç†è€…å¯†ç¢¼ (admin)</h3>
                        <form id="adminPasswordForm">
                            <div class="form-group">
                                <label for="newAdminPassword">è¼¸å…¥æ–°å¯†ç¢¼</label>
                                <input type="password" id="newAdminPassword" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label for="confirmAdminPassword">ç¢ºèªæ–°å¯†ç¢¼</label>
                                <input type="password" id="confirmAdminPassword" required minlength="6">
                            </div>
                            <button type="submit" class="btn btn-warning"><i class="fas fa-key"></i> è®Šæ›´ç®¡ç†è€…å¯†ç¢¼</button>
                        </form>
                    </div>
                    <div class="settings-card">
                        <h3>ä¸»è¦ç®¡ç†è€…è³‡æ–™ (æ¨¡æ“¬)</h3>
                        <form id="adminProfileForm">
                            <div class="form-group">
                                <label for="adminAccount">ç®¡ç†è€…å¸³è™Ÿ</label>
                                <input type="text" id="adminAccount" value="admin">
                            </div>
                            <div class="form-group">
                                <label for="adminEmail">ç®¡ç†è€… Email</label>
                                <input type="email" id="adminEmail" value="admin@example.com">
                            </div>
                            <button type="submit" class="btn btn-secondary"><i class="fas fa-save"></i> å„²å­˜ç®¡ç†è€…è³‡æ–™</button>
                        </form>
                    </div>
                    <div class="settings-card">
                        <h3>å‰µå»ºç¬¬äºŒç®¡ç†è€… (æ¨¡æ“¬)</h3>
                        <p style="color: var(--color-text-dim); font-size: 0.9em;">æ­¤åŠŸèƒ½ç‚ºç¤ºç¯„ï¼ŒçœŸå¯¦æ¬Šé™ç®¡ç†éœ€è¦å¾Œç«¯è³‡æ–™åº«ã€‚</p>
                        <form id="secondAdminForm">
                            <div class="form-group">
                                <label for="secondAdminAccount">æ–°ç®¡ç†è€…å¸³è™Ÿ</label>
                                <input type="text" id="secondAdminAccount">
                            </div>
                            <div class="form-group">
                                <label for="secondAdminPassword">æ–°ç®¡ç†è€…å¯†ç¢¼</label>
                                <input type="password" id="secondAdminPassword">
                            </div>
                            <div class="form-group">
                                <label>æ¬Šé™ (æ¨¡æ“¬)</label>
                                <select>
                                    <option value="full">å®Œå…¨æ§åˆ¶</option>
                                    <option value="editor">ç·¨è¼¯è€… (å¯ç®¡ç†ç”¢å“/è¨‚å–®)</option>
                                    <option value="viewer">æª¢è¦–è€… (åƒ…å¯æŸ¥çœ‹)</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary"><i class="fas fa-user-plus"></i> å‰µå»ºå¸³æˆ¶</button>
                        </form>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">æ–°å¢å•†å“</h2>
                <span class="close-btn" id="closeProductModalBtn">&times;</span>
            </div>
            <form id="productForm">
                <input type="hidden" id="productId">
                <input type="hidden" id="productImageUrl">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="productName">å•†å“åç¨±</label>
                        <input type="text" id="productName" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productMainCategory">ä¸»è¦é¡åˆ¥ (shop.html ç¯©é¸ç”¨)</label>
                        <select id="productMainCategory" name="mainCategory" required>
                            <option value="security">æ™ºèƒ½å®‰é˜² (security)</option>
                            <option value="network">ç¶²è·¯è¨­å‚™ (network)</option>
                            <option value="access">é–€ç¦ç³»çµ± (access)</option>
                            <option value="other">å…¶ä»– (other)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="productSubCategory">ç”¢å“ç´°é …é¡åˆ¥ (shop.html ç¯©é¸ç”¨)</label>
                    <select id="productSubCategory" name="categoryText" required>
                        <option value="æœ‰ç·šç›£è¦–å™¨">æœ‰ç·šç›£è¦–å™¨</option>
                        <option value="ç„¡ç·šç›£è¦–å™¨">ç„¡ç·šç›£è¦–å™¨</option>
                        <option value="ç›£è¦–ä¸»æ©Ÿ (NVR)">ç›£è¦–ä¸»æ©Ÿ (NVR)</option>
                        <option value="é–€ç¦ç³»çµ±">é–€ç¦ç³»çµ±</option>
                        <option value="ç¶²è·¯ç·š/é›»è©±ç·š">ç¶²è·¯ç·š/é›»è©±ç·š</option>
                        <option value="å­˜å„²ç¡¬ç¢Ÿ">å­˜å„²ç¡¬ç¢Ÿ</option>
                        <option value="å…¶ä»–é…ä»¶">å…¶ä»–é…ä»¶</option>
                        <option value="å…¶ä»–">å…¶ä»– (ä¸ç¬¦ä¸Šè¿°)</option>
                    </select>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="productPrice">åƒ¹æ ¼</label>
                        <input type="number" id="productPrice" name="price" required min="0">
                    </div>
                    <div class="form-group">
                        <label for="productStock">åº«å­˜</label>
                        <input type="number" id="productStock" name="stock" required min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label for="productDescription">å•†å“æè¿°</label>
                    <textarea id="productDescription" name="description" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="productImageFile">ä¸Šå‚³åœ–ç‰‡ (æˆ–è²¼å…¥ Base64)</label>
                    <input type="file" id="productImageFile" accept="image/*">
                    <img id="productImagePreview" src="" alt="Image Preview" style="display:none; max-width: 200px; margin-top: 10px;">
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="productIsFeatured" name="isFeatured" style="width: auto; margin-bottom: 0;">
                    <label for="productIsFeatured" style="display: inline; margin-left: 10px;">
                        è¨­ç‚ºé¦–é ç†±éŠ·å•†å“ (Featured)
                    </label>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;"><i class="fas fa-save"></i> å„²å­˜</button>
            </form>
        </div>
    </div>

    <div id="passwordModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="modalUserNameDisplay">è®Šæ›´å¯†ç¢¼</h2>
                <span class="close-btn" id="closePasswordModalBtn">&times;</span>
            </div>
            <form id="individualPasswordForm">
                <input type="hidden" id="modalUserId">
                <div class="form-group">
                    <label for="newIndividualPassword">è¼¸å…¥æ–°å¯†ç¢¼</label>
                    <input type="password" id="newIndividualPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="confirmIndividualPassword">ç¢ºèªæ–°å¯†ç¢¼</label>
                    <input type="password" id="confirmIndividualPassword" required minlength="6">
                </div>
                <button type="submit" class="btn btn-warning" style="width: 100%; padding: 12px;"><i class="fas fa-key"></i> ç¢ºèªè®Šæ›´</button>
            </form>
        </div>
    </div>

    <div id="downloadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="downloadModalTitle">æ–°å¢ä¸‹è¼‰é …ç›®</h2>
                <span class="close-btn" id="closeDownloadModalBtn">&times;</span>
            </div>
            <form id="downloadForm">
                <input type="hidden" id="downloadId">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="downloadTitle">æ¨™é¡Œ</label>
                        <input type="text" id="downloadTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="downloadCategory">åˆ†é¡ (å°æ‡‰ faq_download.html)</label>
                        <select id="downloadCategory" required>
                            <option value="program">ç¨‹å¼ä¸‹è¼‰ (program)</option>
                            <option value="document">æ–‡ä»¶ä¸‹è¼‰ (document)</option>
                            <option value="image">åœ–æª”ä¸‹è¼‰ (image)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="downloadDescription">æª”æ¡ˆèªªæ˜</label>
                    <textarea id="downloadDescription" rows="2"></textarea>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="downloadUrl">æª”æ¡ˆ URL (é€£çµ)</label>
                        <input type="url" id="downloadUrl" placeholder="https://... æˆ– /files/...">
                    </div>
                    
                    <div class="form-group">
                        <label for="downloadIcon">åœ–ç¤º (Font Awesome Class)</label>
                        <select id="downloadIcon" name="icon" required>
                            <option value="fas fa-file-pdf" selected>PDF æ–‡ä»¶ (fas fa-file-pdf)</option>
                            <option value="fab fa-windows">Windows (fab fa-windows)</option>
                            <option value="fab fa-apple">Apple (fab fa-apple)</option>
                            <option value="fab fa-android">Android (fab fa-android)</option>
                            <option value="fas fa-file-archive">å£“ç¸®æª” (fas fa-file-archive)</option>
                            <option value="fas fa-image">åœ–ç‰‡ (fas fa-image)</option>
                            <option value="fas fa-file-word">Word (fas fa-file-word)</option>
                            <option value="fas fa-file-excel">Excel (fas fa-file-excel)</option>
                            <option value="fas fa-download">ä¸‹è¼‰ (fas fa-download)</option>
                            <option value="fas fa-file">é€šç”¨æ–‡ä»¶ (fas fa-file)</option>
                        </select>
                    </div>
                    </div>

                <div class="form-group-inline">
                    <input type="checkbox" id="downloadIsVisible">
                    <label for="downloadIsVisible">é¡¯ç¤ºæ–¼ä¸‹è¼‰ä¸­å¿ƒ (Visible)</label>
                    
                    <input type="checkbox" id="downloadIsDownloadable">
                    <label for="downloadIsDownloadable">å…è¨±ä¸‹è¼‰ (Downloadable)</label>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; margin-top: 20px;"><i class="fas fa-save"></i> å„²å­˜</button>
            </form>
        </div>
    </div>

    <div id="faqModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="faqModalTitle">æ–°å¢ FAQ</h2>
                <span class="close-btn" id="closeFaqModalBtn">&times;</span>
            </div>
            <form id="faqForm">
                <input type="hidden" id="faqId">
                
                <div class="form-group">
                    <label for="faqQuestion">å•é¡Œ (Question)</label>
                    <input type="text" id="faqQuestion" required placeholder="Q: ...">
                </div>

                <div class="form-group">
                    <label for="faqAnswer">ç­”æ¡ˆ (Answer)</label>
                    <textarea id="faqAnswer" rows="5" required placeholder="<p><strong>A:</strong> ...</p> (æ”¯æ´ HTML)"></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; margin-top: 10px;"><i class="fas fa-save"></i> å„²å­˜</button>
            </form>
        </div>
    </div>


    <script>
        // ====================================
        // æ ¸å¿ƒè³‡æ–™èˆ‡å„²å­˜ (ä½¿ç”¨ LocalStorage æ¨¡æ“¬è³‡æ–™åº«)
        // ====================================
        const INITIAL_PRODUCTS_DATA = [
            // ... (åŸå§‹ç”¢å“è³‡æ–™)
            { id: "CAM001", title: "æ¥µå…‰ Pro 4K ç¶²è·¯æ”å½±æ©Ÿ", mainCategory: "security", categoryText: "æœ‰ç·šç›£è¦–å™¨", price: 8990, description: "...", image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231f1f1f'/><circle cx='50' cy='45' r='20' fill='%2300ffff'/><path d='M30 65H70L50 85Z' fill='%2300ffff'/><text x='50' y='95' font-size='10' fill='%23aaa' text-anchor='middle'>Camera 001</text></svg>", stock: 10, isFeatured: true },
            { id: "ACC002", title: "æ™ºèƒ½æŒ‡ç´‹è¾¨è­˜é–", mainCategory: "access", categoryText: "é–€ç¦ç³»çµ±", price: 12500, description: "...", image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231f1f1f'/><rect x='30' y='30' width='40' height='40' rx='5' fill='%230077b6'/><path d='M40 40H60V60H40Z' fill='white'/><text x='50' y='95' font-size='10' fill='%23aaa' text-anchor='middle'>Access 002</text></svg>", stock: 5, isFeatured: true },
            { id: "NET003", title: "ä¼æ¥­ç´š Wi-Fi 6 è·¯ç”±å™¨", mainCategory: "network", categoryText: "å…¶ä»–é…ä»¶", price: 5200, description: "...", image: "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231f1f1f'/><rect x='20' y='40' width='60' height='20' rx='2' fill='%2300ffff'/><path d='M30 40V20M70 40V20' stroke='%2300ffff' stroke-width='3'/><text x='50' y='95' font-size='10' fill='%23aaa' text-anchor='middle'>Network 003</text></svg>", stock: 20, isFeatured: true },
        ];
        
        // ğŸ’¡ ä¿®æ­£ï¼šè£œä¸Šæ¨¡æ“¬è³‡æ–™
        const MOCK_ORDERS_DATA = [
            { id: '#20251108A', date: '2025-11-08', user: 'æå…ˆç”Ÿ (M001)', items: 'æ¥µå…‰ Pro 4K x2', total: 17980 },
            { id: '#20251105C', date: '2025-11-05', user: 'ç‹å°å§ (M002)', items: 'Wi-Fi 6 è·¯ç”±å™¨ x1', total: 5200 },
        ];
        const MOCK_MEMBERS_DATA = [
            { id: "M001", name: "æå…ˆç”Ÿ", email: "member1@test.com", password: "N/A", totalSpent: 17980, totalOrders: 1 },
            { id: "M002", name: "ç‹å°å§", email: "member2@test.com", password: "N/A", totalSpent: 5200, totalOrders: 1 },
        ];
        
        // ğŸ’¡ 5. æ–°å¢ï¼šFAQ å’Œ ä¸‹è¼‰ çš„åˆå§‹è³‡æ–™
        const INITIAL_FAQS_DATA = [
            { id: 1, question: "Q: è«‹å•æœå‹™ç¯„åœåŒ…å«å“ªäº›åœ°å€ï¼Ÿ", answer: "<p><strong>A:</strong> æˆ‘å€‘çš„ç¸½éƒ¨è¨­æ–¼æ–°ç«¹ï¼Œä¸»è¦æœå‹™ç¯„åœæ¶µè“‹**æ¡ƒç«¹è‹—**åœ°å€ã€‚å°æ–¼å¤§å‹å°ˆæ¡ˆæˆ–ä¼æ¥­ç´šæ•´åˆéœ€æ±‚ï¼Œæˆ‘å€‘ä¹Ÿæ‰¿æ¥**å…¨å°ç£**çš„æœå‹™ã€‚æ‚¨å¯ä»¥éš¨æ™‚é€éã€Œé—œæ–¼æˆ‘å€‘ã€é é¢çš„è¡¨å–®èˆ‡æˆ‘å€‘è¯ç¹«ï¼Œæˆ‘å€‘å°‡æœ‰å°ˆäººç‚ºæ‚¨è©•ä¼°ã€‚</p>" },
            { id: 2, question: "Q: ä½ å€‘æä¾›ç¾å ´ä¼°åƒ¹å—ï¼Ÿæ˜¯å¦éœ€è¦æ”¶è²»ï¼Ÿ", answer: "<p><strong>A:</strong> æ˜¯çš„ï¼Œæˆ‘å€‘æä¾›ç¾å ´å‹˜æŸ¥èˆ‡ä¼°åƒ¹æœå‹™ã€‚åœ¨æ¡ƒç«¹è‹—åœ°å€ï¼Œæ¨™æº–çš„ç¾å ´å‹˜æŸ¥èˆ‡åˆæ­¥å ±åƒ¹æ˜¯**å…è²»**çš„ã€‚è‹¥éœ€æä¾›è©³ç´°çš„æ–½å·¥è—åœ–æˆ–è·¨å€æœå‹™ï¼Œå¯èƒ½æœƒé…Œæ”¶è»Šé¦¬è²»æˆ–å‡ºåœ–è²»ï¼Œé€™éƒ¨åˆ†æœƒç”±å°ˆæ¡ˆç¶“ç†åœ¨èˆ‡æ‚¨æ¥æ´½æ™‚å…ˆè¡Œå‘ŠçŸ¥ã€‚</p>" },
            { id: 3, question: "Q: ç”¢å“çš„ä¿å›ºæœŸæ˜¯å¤šä¹…ï¼Ÿå”®å¾Œæœå‹™æµç¨‹æ˜¯ï¼Ÿ", answer: "<p><strong>A:</strong> <ul><li><strong>ç”¢å“ä¿å›ºï¼š</strong> ä¾æ“šä¸åŒè¨­å‚™åŸå» è¦å®šï¼Œç¡¬é«”è¨­å‚™ï¼ˆå¦‚æ”å½±æ©Ÿã€ä¸»æ©Ÿã€é–€ç¦è®€å¡æ©Ÿï¼‰é€šå¸¸äº«æœ‰ 1 è‡³ 3 å¹´ä¸ç­‰çš„åŸå» ä¿å›ºã€‚</li><li><strong>æ–½å·¥ä¿å›ºï¼š</strong> ç”±æœ¬å…¬å¸æ–½å·¥å®‰è£çš„éƒ¨åˆ†ï¼Œæˆ‘å€‘æä¾› 1 å¹´çš„æ–½å·¥å“è³ªä¿å›ºã€‚</li><li><strong>å”®å¾Œæœå‹™ï¼š</strong> ä¿å›ºæœŸé–“å…§ï¼Œè‹¥éäººç‚ºæå£ï¼Œæˆ‘å€‘æä¾›å…è²»çš„æª¢ä¿®æœå‹™ã€‚è‹¥å·²éä¿ï¼Œæˆ‘å€‘ä¹Ÿæä¾›ä»˜è²»ç¶­ä¿®èˆ‡ç³»çµ±å¥æª¢ï¼Œç¢ºä¿æ‚¨çš„ç³»çµ±èƒ½é•·ä¹…ç©©å®šé‹ä½œã€‚</li></ul></p>" }
        ];
        const INITIAL_DOWNLOADS_DATA = [
            { id: 1, category: 'program', title: 'é ç«¯ç›£æ§ä¸»ç¨‹å¼ (Windows)', description: 'é©ç”¨æ–¼ Windows 10/11ã€‚', url: '#', icon: 'fab fa-windows', isVisible: true, isDownloadable: true },
            { id: 2, category: 'document', title: 'CAM001 ç”¢å“èªªæ˜æ›¸ (PDF)', description: 'æ¥µå…‰ Pro 4K ç¶²è·¯æ”å½±æ©Ÿ (CAM001) è©³ç´°è¦æ ¼èˆ‡å®‰è£æŒ‡å—ã€‚', url: '#', icon: 'fas fa-file-pdf', isVisible: true, isDownloadable: true },
            { id: 3, category: 'image', title: 'å…¬å¸ Logo (PNG)', description: 'é€æ˜èƒŒæ™¯ï¼Œé«˜è§£æåº¦ã€‚', url: '#', icon: 'fas fa-image', isVisible: false, isDownloadable: true },
            { id: 4, category: 'program', title: 'æ‰‹æ©ŸAPP (Android)', description: 'Android ç‰ˆæœ¬ v3.1.2', url: '#', icon: 'fab fa-android', isVisible: true, isDownloadable: false }
        ];

        let PRODUCTS = [];
        let ALL_USERS = [];
        let DOWNLOADS = []; // ğŸ’¡ æ–°å¢
        let FAQS = []; // ğŸ’¡ æ–°å¢
        
        let currentModalMode = 'add';
        let currentDownloadModalMode = 'add'; // ğŸ’¡ æ–°å¢
        let currentFaqModalMode = 'add'; // ğŸ’¡ æ–°å¢


        // ğŸ’¡ 6. ä¿®æ”¹ï¼šè¼‰å…¥èˆ‡å„²å­˜è³‡æ–™ (Load & Save)
        function loadData() {
            try {
                // ç”¢å“
                const storedProducts = localStorage.getItem('adminProducts');
                PRODUCTS = storedProducts ? JSON.parse(storedProducts) : INITIAL_PRODUCTS_DATA;
                if (!storedProducts) saveProducts();

                // ğŸ’¡ ä¸‹è¼‰
                const storedDownloads = localStorage.getItem('adminDownloads');
                DOWNLOADS = storedDownloads ? JSON.parse(storedDownloads) : INITIAL_DOWNLOADS_DATA;
                if (!storedDownloads) saveDownloads();
                
                // ğŸ’¡ FAQ
                const storedFaqs = localStorage.getItem('adminFaqs');
                FAQS = storedFaqs ? JSON.parse(storedFaqs) : INITIAL_FAQS_DATA;
                if (!storedFaqs) saveFaqs();

            } catch (e) {
                console.error("Error loading data:", e);
                PRODUCTS = INITIAL_PRODUCTS_DATA;
                DOWNLOADS = INITIAL_DOWNLOADS_DATA;
                FAQS = INITIAL_FAQS_DATA;
            }
        }
        
        function saveProducts() {
            try {
                localStorage.setItem('adminProducts', JSON.stringify(PRODUCTS));
            } catch (e) {
                console.error("Error saving product data:", e);
                alert("è­¦å‘Šï¼šç„¡æ³•å„²å­˜ç”¢å“è³‡æ–™ã€‚");
            }
        }
        
        // ğŸ’¡ 7. æ–°å¢ï¼šSave
        function saveDownloads() {
            try {
                localStorage.setItem('adminDownloads', JSON.stringify(DOWNLOADS));
            } catch (e) {
                console.error("Error saving download data:", e);
                alert("è­¦å‘Šï¼šç„¡æ³•å„²å­˜ä¸‹è¼‰è³‡æ–™ã€‚");
            }
        }
        
        function saveFaqs() {
            try {
                localStorage.setItem('adminFaqs', JSON.stringify(FAQS));
            } catch (e) {
                console.error("Error saving FAQ data:", e);
                alert("è­¦å‘Šï¼šç„¡æ³•å„²å­˜ FAQ è³‡æ–™ã€‚");
            }
        }


        // ====================================
        // è«®è©¢è³‡æ–™è®€å–èˆ‡ç®¡ç†
        // ====================================
        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function loadRegistrations() {
            let registrations = [];
            try {
                const data = localStorage.getItem('USER_REGISTRATIONS');
                registrations = data ? JSON.parse(data) : [];
            } catch (e) {
                console.error("ç„¡æ³•è®€å–è«®è©¢è³‡æ–™:", e);
            }
            return registrations;
        }

        function clearRegistrations() {
            if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ 'å‰å°è«®è©¢ç™»è¨˜' å—ï¼Ÿ\næ­¤æ“ä½œå°‡åˆªé™¤ USER_REGISTRATIONS ä¸­çš„æ‰€æœ‰è³‡æ–™ä¸”ç„¡æ³•å¾©åŸã€‚")) {
                try {
                    localStorage.removeItem('USER_REGISTRATIONS');
                    renderRegistrationTable(); // é‡æ–°æ¸²æŸ“ç©ºè¡¨æ ¼
                    alert('è«®è©¢è³‡æ–™å·²æ¸…ç©ºï¼');
                } catch (e) {
                    alert('æ¸…ç©ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ä¸»æ§å°ã€‚');
                }
            }
        }

        function renderRegistrationTable() {
            const tableBody = document.querySelector('#registrationTable tbody');
            if (!tableBody) return;
            const registrations = loadRegistrations();
            tableBody.innerHTML = ''; // æ¸…ç©º

            if (registrations.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align:center; color: var(--color-text-dim);">å°šç„¡è«®è©¢è³‡æ–™</td></tr>';
                return;
            }

            registrations.forEach(reg => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${reg.date || 'N/A'}</td>
                    <td>${reg.name}</td>
                    <td>${reg.company || 'N/A'}</td>
                    <td><a href="mailto:${reg.email}">${reg.email}</a></td>
                    <td><a href="tel:${reg.phone}">${reg.phone}</a></td>
                    <td class="message-cell" title="${reg.message}">${reg.message}</td>
                `;
            });
        }
        
        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function prepareUserData() {
            let storedUsers = [];
            try {
                // å¾å‰å°è¨»å†Šçš„æœƒå“¡
                const data = localStorage.getItem('userManagementData');
                storedUsers = data ? JSON.parse(data) : [];
            } catch (e) { console.error("ç„¡æ³•è®€å–ç¶²ç«™è¨»å†Šæœƒå“¡:", e); }
            
            // åˆä½µæ¨¡æ“¬æœƒå“¡ + ç¶²ç«™è¨»å†Šæœƒå“¡
            ALL_USERS = [...MOCK_MEMBERS_DATA, ...storedUsers];
        }
        
        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function previewImage(event) {
            const file = event.target.files[0];
            if (!file) {
                document.getElementById('productImageUrl').value = ''; // æ¸…é™¤
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64String = e.target.result;
                const preview = document.getElementById('productImagePreview');
                preview.src = base64String;
                preview.style.display = 'block';
                // å°‡ Base64 å­˜å…¥éš±è—æ¬„ä½ï¼Œæº–å‚™æäº¤
                document.getElementById('productImageUrl').value = base64String;
            };
            reader.readAsDataURL(file);
        }

        // ====================================
        // 1. å•†å“ç®¡ç† (CRUD) é‚è¼¯ 
        // ====================================
        // ğŸ’¡ ä¿®æ­£ #3ï¼šå¡«å…¥ç©ºæ®¼
        function renderProductTable() {
            const tableBody = document.querySelector('#productTable tbody');
            if (!tableBody) return;
            tableBody.innerHTML = ''; // æ¸…ç©º
            
            if (PRODUCTS.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align:center; color: var(--color-text-dim);">å°šç„¡ç”¢å“è³‡æ–™ã€‚è«‹é»æ“Šã€Œæ–°å¢å•†å“ã€ä¾†åŠ å…¥ã€‚</td></tr>';
                return;
            }

            PRODUCTS.forEach(product => {
                const isFeatured = product.isFeatured ? 
                    '<span class="featured-indicator yes" title="æ˜¯"></span> æ˜¯' : 
                    '<span class="featured-indicator no" title="å¦"></span> å¦';
                
                // è™•ç†åœ–ç‰‡ (Base64 æˆ– URL)
                const imageSrc = product.image ? (product.image.startsWith('data:image') ? product.image : product.image) : ''; 
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td><img src="${imageSrc}" alt="${product.title}" class="thumb-img" onerror="this.style.display='none'"></td>
                    <td>${product.id}</td>
                    <td>${product.title}</td>
                    <td>NT$ ${product.price.toLocaleString()}</td>
                    <td>${product.stock}</td>
                    <td>${isFeatured}</td>
                    <td>
                        <button class="btn btn-edit" onclick="openProductModal('edit', '${product.id}')"><i class="fas fa-edit"></i> ç·¨è¼¯</button>
                        <button class="btn btn-delete" onclick="deleteProduct('${product.id}')"><i class="fas fa-trash"></i> åˆªé™¤</button>
                    </td>
                `;
            });
        }

        // ğŸ’¡ ä¿®æ­£ #3ï¼šå¡«å…¥ç©ºæ®¼
        function openProductModal(mode, id = null) {
            const modal = document.getElementById('productModal');
            const form = document.getElementById('productForm');
            const title = document.getElementById('modalTitle');
            const preview = document.getElementById('productImagePreview');
            if (!modal || !form || !title) return;
            
            form.reset();
            currentModalMode = mode;
            title.textContent = mode === 'add' ? 'æ–°å¢å•†å“' : 'ç·¨è¼¯å•†å“';
            preview.style.display = 'none';
            preview.src = '';
            document.getElementById('productImageUrl').value = ''; // æ¸…ç©ºéš±è— image URL

            if (mode === 'edit' && id) {
                const product = PRODUCTS.find(p => p.id === id);
                if (product) {
                    document.getElementById('productId').value = product.id;
                    document.getElementById('productName').value = product.title;
                    document.getElementById('productMainCategory').value = product.mainCategory || 'other';
                    document.getElementById('productSubCategory').value = product.categoryText || 'å…¶ä»–';
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productStock').value = product.stock;
                    document.getElementById('productDescription').value = product.description || '';
                    document.getElementById('productIsFeatured').checked = !!product.isFeatured;
                    
                    if (product.image) {
                        document.getElementById('productImageUrl').value = product.image; // å„²å­˜èˆŠçš„ Base64/URL
                        preview.src = product.image;
                        preview.style.display = 'block';
                    }
                }
            } else {
                document.getElementById('productId').value = '';
            }
            modal.style.display = 'block';
        }

        // ğŸ’¡ ä¿®æ­£ #3ï¼šå¡«å…¥ç©ºæ®¼
        function closeProductModal() {
            const modal = document.getElementById('productModal');
            if (modal) modal.style.display = 'none';
            document.getElementById('productImagePreview').src = '';
            document.getElementById('productForm').reset();
        }

        // ğŸ’¡ ä¿®æ­£ #3ï¼šå¡«å…¥ç©ºæ®¼
        function deleteProduct(id) {
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ ID: ${id} çš„å•†å“å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`)) {
                PRODUCTS = PRODUCTS.filter(p => p.id !== id);
                saveProducts();
                renderProductTable();
                renderAnalytics(); // åˆªé™¤å•†å“å¾Œï¼Œæ›´æ–°æ•¸æ“šåˆ†æ
                alert('å•†å“å·²åˆªé™¤ï¼');
            }
        }

        // ====================================
        // 2. æ•¸æ“šåˆ†æ (Analytics) é‚è¼¯
        // ====================================
        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function calculateAnalytics() {
            const totalRevenue = MOCK_ORDERS_DATA.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = MOCK_ORDERS_DATA.length;
            const totalUsers = ALL_USERS.length;
            const totalProducts = PRODUCTS.length;
            
            const salesData = MOCK_ORDERS_DATA.reduce((acc, order) => {
                const [item, quantity] = order.items.split(' x');
                const product = PRODUCTS.find(p => p.title.includes(item));
                
                if(product) {
                    if (!acc[product.id]) {
                        acc[product.id] = { id: product.id, title: product.title, count: 0, revenue: 0 };
                    }
                    acc[product.id].count += parseInt(quantity, 10);
                    acc[product.id].revenue += order.total;
                }
                return acc;
            }, {});

            const transactions = {
                '2025-11': 2,
                '2025 (Total)': 2
            };

            return { totalRevenue, totalOrders, totalUsers, totalProducts, salesData: Object.values(salesData), transactions };
        }

        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function renderAnalytics() {
            const data = calculateAnalytics();
            const grid = document.getElementById('statsGrid');
            if (!grid) return;
            
            grid.innerHTML = `
                <div class="stat-card">
                    <h3>ç¸½éŠ·å”®é¡ (æ¨¡æ“¬)</h3>
                    <p>NT$ ${data.totalRevenue.toLocaleString()}</p>
                    <i class="fas fa-dollar-sign icon"></i>
                </div>
                <div class="stat-card">
                    <h3>ç¸½è¨‚å–®æ•¸ (æ¨¡æ“¬)</h3>
                    <p>${data.totalOrders}</p>
                    <i class="fas fa-receipt icon"></i>
                </div>
                <div class="stat-card">
                    <h3>ç¸½æœƒå“¡æ•¸ (å«è¨»å†Š)</h3>
                    <p>${data.totalUsers}</p>
                    <i class="fas fa-users icon"></i>
                </div>
                <div class="stat-card">
                    <h3>ç¸½ç”¢å“æ•¸</h3>
                    <p>${data.totalProducts}</p>
                    <i class="fas fa-box-open icon"></i>
                </div>
            `;
            
            const salesBody = document.querySelector('#salesTable tbody');
            salesBody.innerHTML = '';
            data.salesData.sort((a,b) => b.revenue - a.revenue).forEach(item => {
                salesBody.innerHTML += `<tr><td>${item.title}</td><td>${item.id}</td><td>${item.count}</td><td>NT$ ${item.revenue.toLocaleString()}</td></tr>`;
            });

            const transBody = document.querySelector('#transactionsTable tbody');
            transBody.innerHTML = '';
            Object.keys(data.transactions).forEach(key => {
                transBody.innerHTML += `<tr><td>${key}</td><td>${data.transactions[key]}</td></tr>`;
            });
        }

        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function exportSalesData() {
            alert("åŒ¯å‡ºéŠ·å”®æ•¸æ“š (CSV)\n\n(æ­¤ç‚ºæ¨¡æ“¬åŠŸèƒ½ï¼Œé»æ“Šå¾Œå°‡è§¸ç™¼ CSV ä¸‹è¼‰)");
        }

        // ====================================
        // 3. è¨‚å–®ç®¡ç† (Order Management)
        // ====================================
        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function renderOrderTable() {
            const tableBody = document.querySelector('#orderTable tbody');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            
            MOCK_ORDERS_DATA.forEach(order => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.date}</td>
                    <td>${order.user}</td>
                    <td>${order.items}</td>
                    <td>NT$ ${order.total.toLocaleString()}</td>
                `;
            });
        }

        // ====================================
        // 4. ä½¿ç”¨è€…ç®¡ç† (User Management)
        // ====================================
        // ğŸ’¡ ä¿®æ­£ #1ï¼šå¡«å…¥ç©ºæ®¼ä¸¦ä¿®å¾© Bug
        function renderUserTable(usersToRender) {
            const tableBody = document.querySelector('#userTable tbody');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            
            if (!usersToRender || usersToRender.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align:center; color: var(--color-text-dim);">å°šç„¡ä½¿ç”¨è€…è³‡æ–™</td></tr>';
                return;
            }

            usersToRender.forEach(user => {
                // ğŸ’¡ ä¿®æ­£ #1ï¼šä½¿ç”¨ String(user.id) é¿å… .startsWith 
                const isRegisteredUser = !String(user.id).startsWith('M');
                const idType = isRegisteredUser ? `è¨»å†Š (ID: ${user.id})` : `æ¨¡æ“¬ (ID: ${user.id})`;
                
                const passwordDisplay = isRegisteredUser ? (user.password ? `${user.password.substring(0, 3)}...` : 'N/A') : 'N/A';
                const emailDisplay = isRegisteredUser ? `<a href="mailto:${user.email}">${user.email}</a>` : (user.email || 'N/A');
                
                const passwordButton = isRegisteredUser ? 
                    `<button class="btn btn-warning btn-sm" onclick="openPasswordModal('${user.id}', '${user.name}')">è®Šæ›´</button>` : 
                    'N/A';

                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${idType}</td>
                    <td>${user.name}</td>
                    <td>${emailDisplay}</td>
                    <td>${passwordDisplay}</td>
                    <td>${passwordButton}</td>
                    <td>${user.email || 'N/A'}</td>
                    <td>NT$ ${user.totalSpent || 0}</td>
                    <td>${user.totalOrders || 0}</td>
                `;
            });
        }

        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function searchUsers() {
            const query = document.getElementById('userSearchInput').value.toLowerCase();
            const filteredUsers = ALL_USERS.filter(user => 
                user.name.toLowerCase().includes(query) || 
                (user.email && user.email.toLowerCase().includes(query))
            );
            renderUserTable(filteredUsers);
        }

        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function openPasswordModal(userId, userName) {
            const modal = document.getElementById('passwordModal');
            if (!modal) return;
            
            document.getElementById('modalUserId').value = userId;
            document.getElementById('modalUserNameDisplay').textContent = `è®Šæ›´ ${userName} çš„å¯†ç¢¼`;
            document.getElementById('individualPasswordForm').reset();
            
            modal.style.display = 'block';
        }

        // ğŸ’¡ ä¿®æ­£ï¼šå¡«å…¥ç©ºæ®¼
        function closePasswordModal() {
            const modal = document.getElementById('passwordModal');
            if (modal) modal.style.display = 'none';
        }
        
        
        // ====================================
        // ğŸ’¡ 8. æ–°å¢ï¼šä¸‹è¼‰ç®¡ç† (Download Management)
        // ====================================
        function renderDownloadTable() {
            const tableBody = document.querySelector('#downloadTable tbody');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            
            if (DOWNLOADS.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align:center; color: var(--color-text-dim);">å°šç„¡ä¸‹è¼‰é …ç›®</td></tr>';
                return;
            }

            DOWNLOADS.forEach(item => {
                const isVisible = item.isVisible ? 
                    '<span class="status-indicator yes" title="æ˜¯"></span> æ˜¯' : 
                    '<span class="status-indicator no" title="å¦"></span> å¦';
                
                const isDownloadable = item.isDownloadable ? 
                    '<span class="status-indicator yes" title="æ˜¯"></span> æ˜¯' : 
                    '<span class="status-indicator no" title="å¦"></span> å¦';
                
                const icon = item.icon || 'fas fa-file';

                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td class="icon-cell"><i class="${icon}"></i></td>
                    <td>${item.category}</td>
                    <td>${item.title}</td>
                    <td class="message-cell">${item.description}</td>
                    <td>${isVisible}</td>
                    <td>${isDownloadable}</td>
                    <td>
                        <button class="btn btn-edit" onclick="openDownloadModal('edit', '${item.id}')"><i class="fas fa-edit"></i> ç·¨è¼¯</button>
                        <button class="btn btn-delete" onclick="deleteDownload('${item.id}')"><i class="fas fa-trash"></i> åˆªé™¤</button>
                    </td>
                `;
            });
        }

        function openDownloadModal(mode, id = null) {
            const modal = document.getElementById('downloadModal');
            const form = document.getElementById('downloadForm');
            const title = document.getElementById('downloadModalTitle');
            if (!modal || !form || !title) return;
            
            form.reset();
            currentDownloadModalMode = mode;
            title.textContent = mode === 'add' ? 'æ–°å¢ä¸‹è¼‰é …ç›®' : 'ç·¨è¼¯ä¸‹è¼‰é …ç›®';
            
            if (mode === 'edit' && id) {
                const item = DOWNLOADS.find(d => d.id == id); // id å¯èƒ½æ˜¯æ•¸å­—æˆ–å­—ä¸²
                if (item) {
                    document.getElementById('downloadId').value = item.id;
                    document.getElementById('downloadTitle').value = item.title;
                    document.getElementById('downloadCategory').value = item.category;
                    document.getElementById('downloadDescription').value = item.description;
                    document.getElementById('downloadUrl').value = item.url;
                    document.getElementById('downloadIcon').value = item.icon;
                    document.getElementById('downloadIsVisible').checked = !!item.isVisible;
                    document.getElementById('downloadIsDownloadable').checked = !!item.isDownloadable;
                }
            } else {
                document.getElementById('downloadId').value = '';
                document.getElementById('downloadIsVisible').checked = true;
                document.getElementById('downloadIsDownloadable').checked = true;
                document.getElementById('downloadIcon').value = 'fas fa-file-pdf'; // é è¨­å€¼
            }
            modal.style.display = 'block';
        }

        function closeDownloadModal() {
            const modal = document.getElementById('downloadModal');
            if (modal) modal.style.display = 'none';
        }

        function deleteDownload(id) {
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ ID: ${id} çš„ä¸‹è¼‰é …ç›®å—ï¼Ÿ`)) {
                DOWNLOADS = DOWNLOADS.filter(d => d.id != id);
                saveDownloads();
                renderDownloadTable();
                alert('ä¸‹è¼‰é …ç›®å·²åˆªé™¤ï¼');
            }
        }

        // ====================================
        // ğŸ’¡ 9. æ–°å¢ï¼šFAQ ç®¡ç† (FAQ Management)
        // ====================================
        function renderFaqTable() {
            const tableBody = document.querySelector('#faqTable tbody');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            
            if (FAQS.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" style="text-align:center; color: var(--color-text-dim);">å°šç„¡ FAQ é …ç›®</td></tr>';
                return;
            }

            FAQS.forEach(faq => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${faq.question}</td>
                    <td class="answer-cell">${faq.answer.replace(/<[^>]+>/g, ' ').substring(0, 100)}...</td>
                    <td>
                        <button class="btn btn-edit" onclick="openFaqModal('edit', '${faq.id}')"><i class="fas fa-edit"></i> ç·¨è¼¯</button>
                        <button class="btn btn-delete" onclick="deleteFaq('${faq.id}')"><i class="fas fa-trash"></i> åˆªé™¤</button>
                    </td>
                `;
            });
        }

        function openFaqModal(mode, id = null) {
            const modal = document.getElementById('faqModal');
            const form = document.getElementById('faqForm');
            const title = document.getElementById('faqModalTitle');
            if (!modal || !form || !title) return;
            
            form.reset();
            currentFaqModalMode = mode;
            title.textContent = mode === 'add' ? 'æ–°å¢ FAQ' : 'ç·¨è¼¯ FAQ';
            
            if (mode === 'edit' && id) {
                const faq = FAQS.find(f => f.id == id);
                if (faq) {
                    document.getElementById('faqId').value = faq.id;
                    document.getElementById('faqQuestion').value = faq.question;
                    document.getElementById('faqAnswer').value = faq.answer;
                }
            } else {
                document.getElementById('faqId').value = '';
            }
            modal.style.display = 'block';
        }

        function closeFaqModal() {
            const modal = document.getElementById('faqModal');
            if (modal) modal.style.display = 'none';
        }

        function deleteFaq(id) {
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ ID: ${id} çš„ FAQ å—ï¼Ÿ`)) {
                FAQS = FAQS.filter(f => f.id != id);
                saveFaqs();
                renderFaqTable();
                alert('FAQ å·²åˆªé™¤ï¼');
            }
        }


        // ====================================
        // 5. ç™»å‡ºèˆ‡ç¸½æ§ 
        // ====================================
        // ğŸ’¡ ä¿®æ­£ #2ï¼šå¡«å…¥ç©ºæ®¼
        function handleLogout() {
            if (confirm("æ‚¨ç¢ºå®šè¦ç™»å‡ºå¾Œå°ç®¡ç†ç³»çµ±å—ï¼Ÿ")) {
                try {
                    // æ¸…é™¤å¾Œå°ç™»å…¥ç‹€æ…‹
                    sessionStorage.removeItem('isLoggedIn');
                    sessionStorage.removeItem('currentUserName');
                    sessionStorage.removeItem('currentUserEmail');
                } catch (e) {
                    console.error("ç™»å‡ºæ™‚æ¸…é™¤ sessionStorage å¤±æ•—:", e);
                }
                alert("æ‚¨å·²æˆåŠŸç™»å‡ºã€‚");
                window.location.href = 'index.html'; // å°å›é¦–é 
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            const activeTab = document.getElementById(tabId);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            const navLink = document.querySelector(`.nav-link[data-tab="${tabId}"]`);
            if (navLink) {
                navLink.classList.add('active');
            }

            // ğŸ’¡ 10. ä¿®æ”¹ï¼šåœ¨åˆ‡æ›æ™‚æ‰è¼‰å…¥æ•¸æ“š
            try {
                if (tabId === 'products') {
                    renderProductTable();
                } else if (tabId === 'analytics') {
                    renderAnalytics();
                } else if (tabId === 'orders') {
                    renderOrderTable();
                } else if (tabId === 'users') { 
                    prepareUserData();
                    renderUserTable(ALL_USERS); 
                    renderRegistrationTable();
                } else if (tabId === 'downloads') { // ğŸ’¡ æ–°å¢
                    renderDownloadTable();
                } else if (tabId === 'faqs') { // ğŸ’¡ æ–°å¢
                    renderFaqTable();
                }
            } catch (e) {
                console.error(`è¼‰å…¥ ${tabId} åˆ†é æ™‚å‡ºéŒ¯:`, e);
                alert(`è¼‰å…¥ ${tabId} åˆ†é æ™‚å‡ºéŒ¯ï¼Œè«‹æª¢æŸ¥ä¸»æ§å° (F12)`);
            }
        }

        // ====================================
        // 7. ç¨‹å¼é€²å…¥é» (Entry Point)
        // ====================================

        document.addEventListener('DOMContentLoaded', function() {
            
            // ç™»å…¥é©—è­‰
            // ğŸ’¡ ä¿®æ­£ï¼šç§»é™¤è¨»è§£ï¼Œè®“ç™»å…¥é©—è­‰ç”Ÿæ•ˆ
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            if (isLoggedIn !== 'admin') {
                alert("æ‚¨æ²’æœ‰æ¬Šé™è¨ªå•æ­¤é é¢ï¼Œè«‹å…ˆç™»å…¥ã€‚");
                window.location.href = 'index.html';
                return; // åœæ­¢åŸ·è¡Œ
            }
            
            try {
                loadData(); 
                prepareUserData(); 
            } catch (e) {
                console.error("å•Ÿå‹•æ™‚è¼‰å…¥åŸºç¤è³‡æ–™å¤±æ•—:", e);
                alert("è¼‰å…¥åŸºç¤è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼ŒåŠŸèƒ½å¯èƒ½ä¸å®Œæ•´ã€‚");
            }


            // --- ç¶å®šæ‰€æœ‰äº‹ä»¶ç›£è½å™¨ ---

            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    switchTab(this.getAttribute('data-tab'));
                });
            });
            
            // ... (å…¶ä»–æ—¢æœ‰æŒ‰éˆ•ç¶å®š) ...
            if (document.getElementById('logoutBtn')) document.getElementById('logoutBtn').addEventListener('click', (e) => { e.preventDefault(); handleLogout(); });
            if (document.getElementById('exportSalesButton')) document.getElementById('exportSalesButton').addEventListener('click', exportSalesData);
            if (document.getElementById('userSearchButton')) document.getElementById('userSearchButton').addEventListener('click', searchUsers);
            if (document.getElementById('clearRegistrationsButton')) document.getElementById('clearRegistrationsButton').addEventListener('click', clearRegistrations);
            if (document.getElementById('addNewProductBtn')) document.getElementById('addNewProductBtn').addEventListener('click', () => openProductModal('add'));
            if (document.getElementById('closeProductModalBtn')) document.getElementById('closeProductModalBtn').addEventListener('click', closeProductModal);
            if (document.getElementById('productImageFile')) document.getElementById('productImageFile').addEventListener('change', previewImage);
            if (document.getElementById('closePasswordModalBtn')) document.getElementById('closePasswordModalBtn').addEventListener('click', closePasswordModal);


            // ç”¢å“è¡¨å–®æäº¤
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // ğŸ’¡ ä¿®æ­£ #3ï¼šå¡«å…¥ç©ºæ®¼
                    const form = e.target;
                    const id = form.productId.value;
                    const title = form.title.value;
                    const mainCategory = document.getElementById('productMainCategory').value;
                    const categoryText = document.getElementById('productSubCategory').value;
                    const price = parseInt(form.price.value, 10);
                    const stock = parseInt(form.stock.value, 10);
                    const description = form.description.value;
                    const imageBase64 = document.getElementById('productImageUrl').value; // å·²åŒ…å«æ–°æˆ–èˆŠçš„ Base64
                    const isFeatured = form.isFeatured.checked;

                    const productData = {
                        title,
                        mainCategory,
                        categoryText,
                        category: mainCategory, // ä¿æŒèˆŠæ¬„ä½åŒæ­¥
                        price,
                        description,
                        stock,
                        isFeatured,
                        image: imageBase64 || '' // ä½¿ç”¨å„²å­˜çš„ Base64 æˆ–ç©ºå­—ä¸²
                    };

                    if (currentModalMode === 'add') {
                        productData.id = 'PROD' + Date.now(); // ä½¿ç”¨ Timestamp ç¢ºä¿å”¯ä¸€
                        PRODUCTS.push(productData);
                        alert('å•†å“æ–°å¢æˆåŠŸï¼');
                    }
                    else if (currentModalMode === 'edit') {
                        const index = PRODUCTS.findIndex(p => p.id === id);
                        if (index !== -1) {
                            PRODUCTS[index] = { ...PRODUCTS[index], ...productData, id: id }; // ä¿æŒ ID ä¸è®Š
                            alert('å•†å“ç·¨è¼¯æˆåŠŸï¼');
                        }
                    }
                    saveProducts();
                    renderProductTable();
                    renderAnalytics(); // æ›´æ–°æ•¸æ“š
                    closeProductModal();
                });
            }
            
            // å¯†ç¢¼è¡¨å–®æäº¤
            const indPasswordForm = document.getElementById('individualPasswordForm');
            if (indPasswordForm) {
                indPasswordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // ğŸ’¡ ä¿®æ­£ #1ï¼šå¡«å…¥ç©ºæ®¼ä¸¦ä¿®å¾© Bug
                    const userId = document.getElementById('modalUserId').value; // é€™æ˜¯ string
                    const newPwd = document.getElementById('newIndividualPassword').value;
                    const confirmPwd = document.getElementById('confirmIndividualPassword').value;
                    
                    if (newPwd !== confirmPwd) { alert('å…©æ¬¡è¼¸å…¥çš„æ–°å¯†ç¢¼ä¸ä¸€è‡´ï¼'); return; }
                    if (newPwd.length < 6) { alert('å¯†ç¢¼é•·åº¦å¿…é ˆè‡³å°‘ç‚º 6 ä½ã€‚'); return; }
                    
                    // ğŸ’¡ ä¿®æ­£ #1ï¼šä½¿ç”¨ String() æ¯”è¼ƒ
                    const userIndex = ALL_USERS.findIndex(u => String(u.id) === String(userId));
                    
                    if (userIndex !== -1) {
                        // æ›´æ–° ALL_USERS é™£åˆ—
                        ALL_USERS[userIndex].password = newPwd;
                        
                        // æ›´æ–° localStorage ('userManagementData')
                        const registeredUsers = ALL_USERS.filter(u => !String(u.id).startsWith('M'));
                        try {
                            localStorage.setItem('userManagementData', JSON.stringify(registeredUsers));
                        } catch (e) {
                            alert('å„²å­˜å¯†ç¢¼å¤±æ•—ï¼šç€è¦½å™¨å„²å­˜åŠŸèƒ½ç•°å¸¸ã€‚');
                            return;
                        }
                        
                        alert(`ä½¿ç”¨è€… ${ALL_USERS[userIndex].name} çš„å¯†ç¢¼å·²è®Šæ›´æˆåŠŸï¼`);
                        renderUserTable(ALL_USERS);
                        closePasswordModal();
                    }
                    else { alert('æ‰¾ä¸åˆ°è©²ä½¿ç”¨è€…ã€‚'); }
                });
            }
            
            // ğŸ’¡ ä¿®æ­£ #5ï¼šç®¡ç†è€…è³‡æ–™è¡¨å–®
            const adminProfileForm = document.getElementById('adminProfileForm');
            if (adminProfileForm) {
                // è¼‰å…¥æ™‚ï¼Œå¾ sessionStorage å¡«å…¥
                try {
                    document.getElementById('adminAccount').value = sessionStorage.getItem('currentUserName') || 'admin';
                    document.getElementById('adminEmail').value = sessionStorage.getItem('currentUserEmail') || 'admin';
                } catch(e) {}

                adminProfileForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newName = document.getElementById('adminAccount').value;
                    const newEmail = document.getElementById('adminEmail').value;
                    try {
                        sessionStorage.setItem('currentUserName', newName);
                        sessionStorage.setItem('currentUserEmail', newEmail);
                        alert('ç®¡ç†è€…è³‡æ–™å·²æ›´æ–°ï¼\n(æ­¤è³‡æ–™åƒ…å„²å­˜æ–¼æœ¬æ¬¡ç™»å…¥çš„ session)');
                    } catch(e) {
                        alert('å„²å­˜å¤±æ•—ï¼šç€è¦½å™¨å„²å­˜åŠŸèƒ½ç•°å¸¸ã€‚');
                    }
                });
            }
            
            // ğŸ’¡ ä¿®æ­£ #5ï¼šç®¡ç†è€…å¯†ç¢¼è¡¨å–®
            const adminPasswordForm = document.getElementById('adminPasswordForm');
            if (adminPasswordForm) {
                adminPasswordForm.addEventListener('submit', (e) => { 
                    e.preventDefault(); 
                    const newPass = document.getElementById('newAdminPassword').value;
                    const confirmPass = document.getElementById('confirmAdminPassword').value;
                    if (newPass.length < 6) {
                        alert('å¯†ç¢¼é•·åº¦å¿…é ˆè‡³å°‘ç‚º 6 ä½ã€‚');
                        return;
                    }
                    if (newPass !== confirmPass) {
                        alert('å…©æ¬¡è¼¸å…¥çš„æ–°å¯†ç¢¼ä¸ä¸€è‡´ï¼');
                        return;
                    }
                    // é€™æ˜¯æ¨¡æ“¬åŠŸèƒ½ï¼Œå› ç‚º "admin" å¸³è™Ÿçš„å¯†ç¢¼æ˜¯å¯«æ­»åœ¨ index.html çš„ JS è£¡çš„
                    alert('ç®¡ç†è€…å¯†ç¢¼å·²è®Šæ›´ï¼(æ­¤ç‚ºæ¨¡æ“¬åŠŸèƒ½)\næ‚¨ä¸‹æ¬¡ç™»å…¥æ™‚ä»è«‹ä½¿ç”¨ "123456"');
                    adminPasswordForm.reset();
                });
            }

            if (document.getElementById('secondAdminForm')) document.getElementById('secondAdminForm').addEventListener('submit', (e) => { e.preventDefault(); alert('(æ¨¡æ“¬) å·²å‰µå»ºç¬¬äºŒç®¡ç†è€…å¸³æˆ¶ï¼'); });


            // ğŸ’¡ 11. æ–°å¢ï¼šç¶å®šä¸‹è¼‰ç®¡ç† (Download)
            if (document.getElementById('addNewDownloadBtn')) {
                document.getElementById('addNewDownloadBtn').addEventListener('click', () => openDownloadModal('add'));
            }
            if (document.getElementById('closeDownloadModalBtn')) {
                document.getElementById('closeDownloadModalBtn').addEventListener('click', closeDownloadModal);
            }
            const downloadForm = document.getElementById('downloadForm');
            if (downloadForm) {
                downloadForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const id = document.getElementById('downloadId').value;
                    const itemData = {
                        id: id || Date.now(), // æ–°å¢æ™‚ä½¿ç”¨ timestamp
                        title: document.getElementById('downloadTitle').value,
                        category: document.getElementById('downloadCategory').value,
                        description: document.getElementById('downloadDescription').value,
                        url: document.getElementById('downloadUrl').value || '#',
                        icon: document.getElementById('downloadIcon').value, // ä¾†è‡ª <select>
                        isVisible: document.getElementById('downloadIsVisible').checked,
                        isDownloadable: document.getElementById('downloadIsDownloadable').checked,
                    };

                    if (currentDownloadModalMode === 'add') {
                        DOWNLOADS.push(itemData);
                        alert('ä¸‹è¼‰é …ç›®æ–°å¢æˆåŠŸï¼');
                    } else {
                        const index = DOWNLOADS.findIndex(d => d.id == id);
                        if (index !== -1) {
                            DOWNLOADS[index] = itemData;
                            alert('ä¸‹è¼‰é …ç›®ç·¨è¼¯æˆåŠŸï¼');
                        }
                    }
                    saveDownloads();
                    renderDownloadTable();
                    closeDownloadModal();
                });
            }


            // ğŸ’¡ 12. æ–°å¢ï¼šç¶å®š FAQ ç®¡ç†
            if (document.getElementById('addNewFaqBtn')) {
                document.getElementById('addNewFaqBtn').addEventListener('click', () => openFaqModal('add'));
            }
            if (document.getElementById('closeFaqModalBtn')) {
                document.getElementById('closeFaqModalBtn').addEventListener('click', closeFaqModal);
            }
            const faqForm = document.getElementById('faqForm');
            if (faqForm) {
                faqForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const id = document.getElementById('faqId').value;
                    const faqData = {
                        id: id || Date.now(),
                        question: document.getElementById('faqQuestion').value,
                        answer: document.getElementById('faqAnswer').value,
                    };

                    if (currentFaqModalMode === 'add') {
                        FAQS.push(faqData);
                        alert('FAQ æ–°å¢æˆåŠŸï¼');
                    } else {
                        const index = FAQS.findIndex(f => f.id == id);
                        if (index !== -1) {
                            FAQS[index] = faqData;
                            alert('FAQ ç·¨è¼¯æˆåŠŸï¼');
                        }
                    }
                    saveFaqs();
                    renderFaqTable();
                    closeFaqModal();
                });
            }


            // --- é è¨­è¼‰å…¥ ---
            switchTab('analytics');
        });

    </script>

</body>
</html>